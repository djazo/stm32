# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

STM32 register definitions library using Intel GROOV (Generic Register Operation Optimizer). This is a header-only C++23 library providing type-safe, compile-time optimized access to STM32 peripheral registers.

## Build Commands

```bash
# This is a header-only library consumed as a Meson subproject
# No standalone build - used via parent project's meson.build:
#   stm32_sub = subproject('stm32')
#   stm32_dep = stm32_sub.get_variable('stm32_dep')

# Format code
clang-format -i <file>
```

## Architecture

### Directory Structure
- `include/stm32/common/` - Shared access types and bit type definitions
- `include/stm32/registers/` - Reusable peripheral register templates by MCU family (e.g., `stm32f1/`)
- `include/stm32/<mcu>/` - MCU-specific headers (e.g., `stm32f103/`, `stm32g431xx/`)

### Register Definition Pattern

Headers are auto-generated by `svd2groov` from STM32 SVD files. The pattern uses GROOV's templated register groups:

```cpp
// Register template with name, base address, and offset parameters
template <stdx::ct_string name, std::uint32_t baseaddress, std::uint32_t offset>
using cr_tt = groov::reg<name, std::uint32_t, baseaddress + offset,
                         common::access::rw,
                         groov::field<"ENABLE", bool, 0, 0>,
                         groov::field<"MODE", std::uint8_t, 3, 1>>;

// Peripheral group combining multiple registers
template <stdx::ct_string name, std::uint32_t baseaddress>
using peripheral_t = groov::group<name, groov::mmio_bus<>,
                                  cr_tt<"CR", baseaddress, 0x00>,
                                  sr_tt<"SR", baseaddress, 0x04>>;
```

### Access Types (`common/access.hpp`)
- `rw` - Read-write (replace on write)
- `ro` - Read-only (writes ignored)
- `wo` - Write-only
- `wr1` - Write-1-to-clear

### Key Dependency
- **GROOV** (`generic-register-operation-optimizer`): Provides compile-time register access optimization

## Code Style

- C++23
- 80-column line limit, 2-space indentation
- Pointer alignment: right (e.g., `int *ptr`)
- Use `.clang-format` for formatting
